<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>UCI Pediatr칤a - Calculadora de Par치metros</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Calculadora de medicamentos y perfusiones para UCI Pedi치trica">
    <meta name="theme-color" content="#4A90E2">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="UCIPED">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Encabezado -->
        <header class="header">
            <div class="header-content">
                <h1 class="logo">
                    <img src="logo.png" alt="UCIPED Logo" class="logo-img">
                    <span>UCI PEDIATR칈A</span>
                </h1>
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <button id="themeToggle" class="theme-toggle" title="Cambiar tema" aria-label="Cambiar tema">
                        <i class="fas fa-moon"></i>
                    </button>
                    <div class="version">v1.0.1 | 07/01/2026</div>
                </div>
            </div>
        </header>
        
        <!-- B칰squeda r치pida de medicamentos -->
        <div class="search-bar-container">
            <div class="search-wrapper">
                <input 
                    type="text" 
                    id="searchInput" 
                    class="search-input" 
                    placeholder="游댌 Buscar medicamento... (adenosina, adrenalina, etc.)"
                    autocomplete="off"
                    aria-label="Buscar medicamentos por nombre"
                    role="combobox"
                    aria-expanded="false"
                    aria-controls="searchResults"
                >
                <div id="searchResults" class="search-results hidden" role="listbox" aria-label="Resultados de b칰squeda de medicamentos"></div>
            </div>
        </div>
        
        <div id="dataLoadWarning" class="result-box hidden" style="margin:10px 0; color:#b00020; font-weight:600;">
            No se pudo cargar datos de medicamentos. Se muestran placeholders.
        </div>

        <!-- Regi칩n aria-live para anuncios de accesibilidad -->
        <div id="ariaAnnouncer" class="sr-only" role="status" aria-live="polite" aria-atomic="true"></div>

        <!-- Datos del paciente -->
        <section class="patient-section">
            <div class="patient-wrapper">
                <div class="patient-input-group">
                    <label for="headerEdadInput">Edad</label>
                    <div class="input-row">
                        <input type="number" id="headerEdadInput" placeholder="a침os" min="0" max="18" step="0.5" value="">
                        <span class="input-unit">a침os</span>
                    </div>
                </div>

                <div class="patient-input-group">
                    <label for="headerPesoInput">Peso</label>
                    <div class="input-row">
                        <input type="number" id="headerPesoInput" placeholder="kg" min="0" step="0.1" value="">
                        <span class="input-unit">kg</span>
                    </div>
                </div>

                <div class="weight-estimator">
                    <button id="estimarPesoBtn" class="btn-estimator" title="Estimar peso por edad">
                        <i class="fas fa-calculator"></i>
                        <span>Estimar Peso</span>
                    </button>
                </div>

                <div class="patient-actions">
                    <button id="calcularHeroBtn" class="btn-action" title="Calcular pesta침a activa" aria-label="Calcular resultados de la pesta침a activa">
                        <i class="fas fa-play"></i>
                    </button>
                    <button id="limpiarHeroBtn" class="btn-action" title="Limpiar resultados pesta침a activa" aria-label="Limpiar resultados de la pesta침a activa">
                        <i class="fas fa-eraser"></i>
                    </button>
                    <button id="limpiarPacienteBtn" class="btn-action" title="Limpiar datos" aria-label="Limpiar todos los datos del paciente">
                        <i class="fas fa-redo"></i>
                    </button>
                    <button id="infoBtn" class="btn-action" title="Ver f칩rmulas" aria-label="Ver informaci칩n y f칩rmulas m칠dicas">
                        <i class="fas fa-question-circle"></i>
                    </button>
                </div>
            </div>
        </section>

        <!-- Navegaci칩n de pesta침as -->
        <nav class="tab-navigation">
            <button class="tab-btn active" data-tab="urgencia"><i class="fas fa-bolt"></i> Urgencia</button>
            <button class="tab-btn" data-tab="intubacion"><i class="fas fa-lungs"></i> Intubaci칩n</button>
            <button class="tab-btn" data-tab="perfusiones"><i class="fas fa-syringe"></i> Perfusiones</button>
            <button class="tab-btn" data-tab="viaaerea"><i class="fas fa-procedures"></i> V칤a A칠rea</button>
            <button class="tab-btn" data-tab="ventilacion"><i class="fas fa-wind"></i> Ventilaci칩n</button>
            <button class="tab-btn" data-tab="signos"><i class="fas fa-heart"></i> Signos Vitales</button>
            <button class="tab-btn" data-tab="formulas"><i class="fas fa-calculator"></i> F칩rmulas</button>
        </nav>

        <!-- Contenido principal -->
        <main class="main-content">
            <div class="tab-content">
                <!-- V칤a A칠rea -->
                <section id="viaaerea" class="tab-panel">
                    <div class="card">
                        <div class="card-header">
                            <h2>V칤a A칠rea y Desfibrilaci칩n</h2>
                            <p>Par치metros de equipo y energ칤a calculados seg칰n edad y peso del paciente.</p>
                        </div>
                        <div class="card-body">
                            <div class="button-group toolbar-hidden">
                                <button id="calcularViaAerea" class="btn btn-primary" aria-label="Calcular par치metros de v칤a a칠rea"><i class="fas fa-calculator"></i> Calcular</button>
                                <button id="limpiarViaAerea" class="btn btn-secondary" aria-label="Limpiar resultados de v칤a a칠rea"><i class="fas fa-redo"></i> Limpiar</button>
                            </div>
                            
                            <div id="resultadoViaAerea" class="result-box hidden">
                                <h3><i class="fas fa-lungs"></i> V칤a A칠rea</h3>
                                <table class="medicines-table">
                                    <tbody>
                                        <tr>
                                            <td><strong>Tubo Endotraqueal (ETT)</strong></td>
                                            <td id="ettSize">-</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Profundidad ETT</strong></td>
                                            <td id="ettDepth">-</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Hoja de Laringoscopio</strong></td>
                                            <td id="laryngoBlade">-</td>
                                        </tr>
                                        <tr>
                                            <td><strong>M치scara Lar칤ngea (LMA)</strong></td>
                                            <td id="lmaSize">-</td>
                                        </tr>
                                    </tbody>
                                </table>
                                
                                <h3><i class="fas fa-heartbeat"></i> Desfibrilaci칩n</h3>
                                <table class="medicines-table">
                                    <tbody>
                                        <tr>
                                            <td><strong>Desfibrilaci칩n (2-4 J/kg)</strong></td>
                                            <td id="defibDose">-</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Cardioversi칩n Sincronizada</strong></td>
                                            <td id="cardioversionDose">-</td>
                                        </tr>
                                    </tbody>
                                </table>
                                
                                <h3><i class="fas fa-procedures"></i> Sondas y Drenajes</h3>
                                <table class="medicines-table">
                                    <tbody>
                                        <tr>
                                            <td><strong>Sonda de Aspiraci칩n</strong></td>
                                            <td id="sondaAspiracion">-</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Sonda Vesical</strong></td>
                                            <td id="sondaVesical">-</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Tubo de T칩rax</strong></td>
                                            <td id="tuboTorax">-</td>
                                        </tr>
                                    </tbody>
                                </table>
                                
                                <div class="info-note" style="margin-top: 16px;">
                                    <i class="fas fa-book-medical"></i>
                                    <div>
                                        <strong>M칠todo:</strong>
                                        <ul style="margin: 8px 0 0 0; padding-left: 20px; font-size: 0.9em;">
                                            <li>Tubo endotraqueal: Tabla de referencia pedi치trica (MATRIZ 2)</li>
                                            <li>Profundidad ETT: Tabla de referencia pedi치trica (MATRIZ 2)</li>
                                            <li>LMA: Selecci칩n por peso - Brain LMA춽 sizing chart, PALS guidelines</li>
                                            <li>Desfibrilaci칩n: Dosis seg칰n peso (2-4 J/kg)</li>
                                            <li>Cardioversi칩n sincronizada: Dosis progresiva 0.5-1-2 J/kg</li>
                                            <li>Sonda de aspiraci칩n: Tabla de referencia pedi치trica (MATRIZ 2)</li>
                                            <li>Sonda vesical: Tabla de referencia pedi치trica (MATRIZ 2)</li>
                                            <li>Tubo de t칩rax: Tabla de referencia pedi치trica (MATRIZ 2)</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Intubaci칩n -->
                <section id="intubacion" class="tab-panel">
                    <div class="card">
                        <div class="card-header">
                            <h2>Medicamentos para Intubaci칩n</h2>
                            <p>Dosis de sedaci칩n, analgesia y relajaci칩n muscular.</p>
                        </div>
                        <div class="card-body">
                            <div class="button-group toolbar-hidden">
                                <button id="calcularIntubacion" class="btn btn-primary" aria-label="Calcular medicamentos de intubaci칩n"><i class="fas fa-calculator"></i> Calcular</button>
                                <button id="limpiarIntubacion" class="btn btn-secondary" aria-label="Limpiar resultados de intubaci칩n"><i class="fas fa-redo"></i> Limpiar</button>
                            </div>
                            
                            <div id="resultadoIntubacion" class="result-box hidden">
                                <h3><i class="fas fa-pills"></i> Medicamentos para Intubaci칩n</h3>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Ventilaci칩n -->
                <section id="ventilacion" class="tab-panel">
                    <div class="card">
                        <div class="card-header">
                            <h2>Ventilaci칩n Mec치nica Inicial</h2>
                            <p>Par치metros de arranque ajustados por edad y peso.</p>
                        </div>
                        <div class="card-body">
                            <div class="input-group" style="max-width:320px; margin-bottom:12px;">
                                <label for="ventModeSelect">Modo</label>
                                <select id="ventModeSelect">
                                    <option value="VC">VC</option>
                                    <option value="PC">PC</option>
                                    <option value="PSV">PSV</option>
                                </select>
                            </div>
                            <div class="button-group toolbar-hidden">
                                <button id="calcularVentilacion" class="btn btn-primary" aria-label="Calcular par치metros de ventilaci칩n"><i class="fas fa-calculator"></i> Calcular</button>
                                <button id="limpiarVentilacion" class="btn btn-secondary" aria-label="Limpiar resultados de ventilaci칩n"><i class="fas fa-redo"></i> Limpiar</button>
                            </div>

                            <div id="resultadoVentilacion" class="result-box hidden">
                                <h3><i class="fas fa-wind"></i> Par치metros Sugeridos</h3>
                                <table class="medicines-table">
                                    <tbody>
                                        <tr>
                                            <td><strong>Modo seleccionado</strong></td>
                                            <td id="ventModeParams">-</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Volumen tidal</strong></td>
                                            <td id="ventVt">-</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Frecuencia respiratoria</strong></td>
                                            <td id="ventFr">-</td>
                                        </tr>
                                        <tr>
                                            <td><strong>PEEP</strong></td>
                                            <td id="ventPeep">-</td>
                                        </tr>
                                        <tr>
                                            <td><strong>FiO2 inicial</strong></td>
                                            <td id="ventFiO2">-</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Relaci칩n I:E</strong></td>
                                            <td id="ventIe">-</td>
                                        </tr>
                                        <tr>
                                            <td><strong>PIP objetivo</strong></td>
                                            <td id="ventPip">-</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Presi칩n soporte (PS)</strong></td>
                                            <td id="ventPs">-</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Plateau (Pplat)</strong></td>
                                            <td id="ventPplat">-</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Driving Pressure</strong></td>
                                            <td id="ventDriving">-</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Flujo inspiratorio</strong></td>
                                            <td id="ventFlow">-</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Trigger</strong></td>
                                            <td id="ventTrigger">-</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Alarmas VM</strong></td>
                                            <td id="ventAlarmVm">-</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Apnea / Backup</strong></td>
                                            <td id="ventApnea">-</td>
                                        </tr>
                                    </tbody>
                                </table>
                                
                                <div class="info-note" style="margin-top: 16px;">
                                    <i class="fas fa-book-medical"></i>
                                    <div>
                                        <strong>Referencias:</strong>
                                        <ul style="margin: 8px 0 0 0; padding-left: 20px; font-size: 0.9em;">
                                            <li>Ventilaci칩n protectora: Vt 6-8 mL/kg peso ideal (ARDSnet, PALICC 2015)</li>
                                            <li>PEEP inicial 5-8 cmH2O, titular seg칰n SpO2/FiO2 (Pediatric Acute Lung Injury Consensus Conference)</li>
                                            <li>Pplat <28 cmH2O, Driving Pressure <15 cmH2O (recomendaciones SDRA pedi치trico)</li>
                                            <li>Frecuencia respiratoria seg칰n edad: Harriet Lane Handbook 22nd ed., PALS 2020</li>
                                            <li>Alarmas de volumen minuto: 80-120% del objetivo calculado (pr치ctica cl칤nica est치ndar UCI pedi치trica)</li>
                                            <li>Tiempo de apnea: RN 10-15s, lactantes 15-20s, ni침os mayores 20-25s (PALS/NRP guidelines)</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Urgencia -->
                <section id="urgencia" class="tab-panel active">
                    <div class="card">
                        <div class="card-header">
                            <h2>Medicamentos de Urgencia</h2>
                            <p>Dosis inmediatas basadas en el peso.</p>
                        </div>
                        <div class="card-body">
                            <div class="button-group toolbar-hidden">
                                <button id="calcularUrgencia" class="btn btn-primary" aria-label="Calcular medicamentos de urgencia"><i class="fas fa-calculator"></i> Calcular</button>
                                <button id="limpiarUrgencia" class="btn btn-secondary" aria-label="Limpiar resultados de urgencia"><i class="fas fa-redo"></i> Limpiar</button>
                            </div>
                            <div id="resultadoUrgencia" class="result-box hidden"></div>
                        </div>
                    </div>
                </section>

                <!-- Perfusiones -->
                <section id="perfusiones" class="tab-panel">
                    <div class="card">
                        <div class="card-header">
                            <h2>Perfusiones</h2>
                            <p>Referencias de perfusiones inotr칩picas y sedoanalgesia.</p>
                        </div>
                        <div class="card-body">
                            <div class="button-group toolbar-hidden">
                                <button id="calcularPerfusiones" class="btn btn-primary" aria-label="Ver tablas de perfusiones"><i class="fas fa-eye"></i> Ver tablas</button>
                                <button id="limpiarPerfusiones" class="btn btn-secondary" aria-label="Limpiar resultados de perfusiones"><i class="fas fa-redo"></i> Limpiar</button>
                            </div>
                            <div id="resultadoPerfusiones" class="hidden">
                                <h3>Perfusiones Inotr칩picas</h3>
                                <table class="medicines-table">
                                    <thead>
                                        <tr>
                                            <th>Medicamento</th>
                                            <th>Rango (por kg)</th>
                                            <th>Dosis calculada (por hora)</th>
                                            <th>Ritmo (mL/h)</th>
                                            <th>Presentaci칩n comercial</th>
                                            <th>Diluci칩n/Preparaci칩n</th>
                                        </tr>
                                    </thead>
                                    <tbody id="perfusionesInoTableBody"></tbody>
                                </table>

                                <h3>Perfusiones Sedoanalgesia</h3>
                                <table class="medicines-table">
                                    <thead>
                                        <tr>
                                            <th>Medicamento</th>
                                            <th>Rango (por kg)</th>
                                            <th>Dosis calculada (por hora)</th>
                                            <th>Ritmo (mL/h)</th>
                                            <th>Presentaci칩n comercial</th>
                                            <th>Diluci칩n/Preparaci칩n</th>
                                        </tr>
                                    </thead>
                                    <tbody id="perfusionesSedoTableBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Signos Vitales -->
                <section id="signos" class="tab-panel">
                    <div class="card">
                        <div class="card-header">
                            <h2>Signos Vitales de Referencia</h2>
                            <p>Rangos esperados seg칰n edad.</p>
                        </div>
                        <div class="card-body">
                            <div class="button-group toolbar-hidden">
                                <button id="obtenerSignos" class="btn btn-primary" aria-label="Obtener rangos de signos vitales"><i class="fas fa-heartbeat"></i> Obtener rangos</button>
                            </div>
                            <div id="resultadoSignos" class="result-box hidden" aria-live="polite" aria-label="Resultados de signos vitales">
                                <h3><i class="fas fa-heartbeat"></i> Par치metros Vitales</h3>
                                <table class="medicines-table">
                                    <tbody>
                                        <tr>
                                            <td><strong>Frecuencia Card칤aca</strong></td>
                                            <td id="fc">-</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Frecuencia Respiratoria</strong></td>
                                            <td id="fr">-</td>
                                        </tr>
                                        <tr>
                                            <td><strong>PAS (sist칩lica)</strong></td>
                                            <td id="pas">-</td>
                                        </tr>
                                        <tr>
                                            <td><strong>PAD (diast칩lica)</strong></td>
                                            <td id="pad">-</td>
                                        </tr>
                                        <tr>
                                            <td><strong>PAM (media)</strong></td>
                                            <td id="pam">-</td>
                                        </tr>
                                        <tr>
                                            <td><strong>SpO2 objetivo</strong></td>
                                            <td id="spo2">-</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Temperatura</strong></td>
                                            <td id="temperatura">-</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Glucemia</strong></td>
                                            <td id="glucemia">-</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Diuresis m칤nima</strong></td>
                                            <td id="diuresis">-</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Relleno capilar</strong></td>
                                            <td id="relleno">-</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Glasgow (normal)</strong></td>
                                            <td id="glasgow">-</td>
                                        </tr>
                                    </tbody>
                                </table>
                                
                                <div class="info-note" style="margin-top: 24px; font-size: 0.9em;">
                                    <i class="fas fa-book-medical"></i>
                                    <div>
                                        <strong>Referencias bibliogr치ficas:</strong>
                                        <ol style="margin: 8px 0 0 20px; padding-left: 0; line-height: 1.6;">
                                            <li>Topjian AA, et al. Part 4: Pediatric Basic and Advanced Life Support: 2020 AHA Guidelines for CPR and ECC. <em>Pediatrics.</em> 2021;147(Suppl 1):S152-S201.</li>
                                            <li>Engorn B, Flerlage J, eds. <em>The Harriet Lane Handbook.</em> 22nd ed. Elsevier; 2021.</li>
                                            <li>American Diabetes Association. Children and Adolescents: Standards of Medical Care in Diabetes. <em>Diabetes Care.</em> 2023;46(S1):S230-S253.</li>
                                            <li>Goldstein SL, et al. Outcome in children receiving continuous venovenous hemofiltration. <em>Pediatr Crit Care Med.</em> 2001;2(4):371-375.</li>
                                            <li>Reilly PL, et al. A paediatric version of the Glasgow Coma Scale. <em>Childs Nerv Syst.</em> 1988;4(1):30-33.</li>
                                        </ol>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- F칩rmulas -->
                <section id="formulas" class="tab-panel">
                    <div class="card">
                        <div class="card-header">
                            <h2>F칩rmulas Frecuentes</h2>
                            <p>Referencias r치pidas.</p>
                        </div>
                        <div class="card-body">
                            <div class="formulas-grid">
                                <div class="formula-item">
                                    <h3>Volumen de Reposici칩n - Depleci칩n 10%</h3>
                                    <p class="formula">Volumen = Peso (kg) 칑 100 mL</p>
                                </div>

                                <div class="formula-item">
                                    <h3>Mantenimiento de L칤quidos (Regla de Holliday)</h3>
                                    <p class="formula">
                                        Primeros 10 kg: 100 mL/kg/d칤a<br>
                                        Siguientes 10 kg: 50 mL/kg/d칤a<br>
                                        Resto: 20 mL/kg/d칤a
                                    </p>
                                </div>

                                <div class="formula-item">
                                    <h3>C치lculo de Calor칤as Diarias</h3>
                                    <p class="formula">
                                        RN: 60 kcal/kg/d칤a<br>
                                        Lactantes: 100-150 kcal/kg/d칤a<br>
                                        Preescolares: 75-100 kcal/kg/d칤a<br>
                                        Escolares: 50-75 kcal/kg/d칤a
                                    </p>
                                </div>

                                <div class="formula-item">
                                    <h3>Endotraqueal Pedi치trico</h3>
                                    <p class="formula">Di치metro = (edad/4) + 4</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>

        <!-- Modal de Informaci칩n con F칩rmulas -->
        <div id="infoModal" class="modal hidden">
            <div class="modal-content modal-info">
                <div class="modal-header">
                    <h2>F칩rmulas de Estimaci칩n de Peso</h2>
                    <button class="modal-close" id="closeInfoModal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="formulas-list">
                        <div class="formula-item">
                            <div class="formula-age-range">0 a 12 meses</div>
                            <div class="formula-expression">Peso (kg) = <strong>3.5 + (edad en meses 칑 0.5)</strong></div>
                            <div class="formula-example">Ejemplo: 6 meses = 3.5 + (6 칑 0.5) = 6.5 kg</div>
                        </div>

                        <div class="formula-item">
                            <div class="formula-age-range">1 a 3 a침os</div>
                            <div class="formula-expression">Peso (kg) = <strong>(edad en a침os + 9) 칑 2</strong></div>
                            <div class="formula-example">Ejemplo: 2 a침os = (2 + 9) 칑 2 = 22 kg</div>
                        </div>

                        <div class="formula-item">
                            <div class="formula-age-range">3 a 6 a침os</div>
                            <div class="formula-expression">Peso (kg) = <strong>(edad en a침os 칑 2) + 8</strong></div>
                            <div class="formula-example">Ejemplo: 5 a침os = (5 칑 2) + 8 = 18 kg</div>
                        </div>

                        <div class="formula-item">
                            <div class="formula-age-range">6 a 12 a침os</div>
                            <div class="formula-expression">Peso (kg) = <strong>(edad en a침os 칑 3) + 7</strong></div>
                            <div class="formula-example">Ejemplo: 10 a침os = (10 칑 3) + 7 = 37 kg</div>
                        </div>

                        <div class="formula-item">
                            <div class="formula-age-range">Mayor de 12 a침os</div>
                            <div class="formula-expression">Peso (kg) = <strong>(edad en a침os 칑 3.5) + 10</strong></div>
                            <div class="formula-example">Ejemplo: 15 a침os = (15 칑 3.5) + 10 = 62.5 kg</div>
                        </div>
                    </div>

                    <div class="info-note">
                        <i class="fas fa-info-circle"></i>
                        <span>Estas f칩rmulas son referencias aproximadas. Para c치lculos precisos, utiliza el peso real del paciente.</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal para F칩rmulas de Peso (completa) -->
        <div id="formulasModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Estimaci칩n de Peso por Edad</h2>
                    <button class="modal-close" id="closeFormulasModal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="peso-estimation-container">
                        <div class="peso-input-section">
                            <label for="edadModalInput">Edad del paciente</label>
                            <div class="edad-input-wrapper">
                                <input type="number" id="edadModalInput" placeholder="0" min="0" max="18" class="edad-input">
                                <span class="edad-unit">a침os</span>
                            </div>
                            <div class="slider-wrapper">
                                <input type="range" id="edadSlider" min="0" max="18" value="0" class="edad-slider">
                                <div class="slider-labels">
                                    <span>RN</span><span>1 a침o</span><span>3 a침os</span><span>6 a침os</span><span>12 a침os</span><span>18 a침os</span>
                                </div>
                            </div>
                        </div>

                        <div class="peso-formula-section">
                            <h3>F칩rmula aplicada</h3>
                            <div class="formula-card" id="formulaCard">
                                <div class="formula-range"><strong>Selecciona una edad</strong></div>
                                <div class="formula-text" id="formulaText"></div>
                            </div>
                        </div>

                        <div class="peso-result-section hidden" id="resultadoPesoModal">
                            <div class="result-box-peso">
                                <div class="result-peso-value">
                                    <span id="pesoResultadoModal" class="peso-numero">-</span>
                                    <span class="peso-unidad">kg</span>
                                </div>
                                <div class="result-peso-detail">
                                    <p id="detalleResultadoModal"></p>
                                </div>
                            </div>
                        </div>

                        <div class="peso-button-group">
                            <button id="calcularPesoModal" class="btn btn-primary btn-large" aria-label="Calcular peso estimado"><i class="fas fa-calculator"></i> Calcular Peso</button>
                            <button id="guardarPesoBtn" class="btn btn-success btn-large hidden" aria-label="Confirmar y guardar peso en el perfil del paciente"><i class="fas fa-check"></i> Confirmar y Guardar</button>
                            <button id="limpiarPesoModal" class="btn btn-secondary btn-large" aria-label="Limpiar c치lculo de peso"><i class="fas fa-redo"></i> Limpiar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Estimador de Peso Simple -->
        <div id="estimadorModal" class="modal hidden">
            <div class="modal-content modal-small">
                <div class="modal-header">
                    <h2>Estimar Peso por Edad</h2>
                    <button class="modal-close" id="closeEstimadorModal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="estimador-content">
                        <div class="estimador-input-group">
                            <label>Edad del paciente</label>
                            <input type="number" id="estimadorEdadInput" placeholder="Ej: 5" min="0" max="18" step="0.5" value="1">
                            <span class="input-unit-inline">a침os</span>
                        </div>
                        <div class="estimador-slider-group">
                            <input type="range" id="estimadorSlider" min="0" max="18" step="0.01" value="1">
                            <div class="slider-value-display"><span id="estimadorSliderValue">1.0</span> <span id="estimadorSliderUnit">a침os</span></div>
                        </div>
                        <div class="estimador-result">
                            <div class="estimador-weight"><span id="estimadorPesoResultado">-</span> kg</div>
                            <div class="estimador-formula"><strong id="estimadorFormula">Selecciona una edad para ver la f칩rmula</strong></div>
                        </div>
                        <div class="estimador-actions">
                            <button id="aplicarEstimacionBtn" class="btn btn-primary" aria-label="Aplicar peso estimado al perfil del paciente"><i class="fas fa-check"></i> Aplicar a Paciente</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de dosis -->
        <div id="dosisModal" class="dosis-modal">
            <div class="dosis-modal-content">
                <div class="dosis-modal-header">
                    <h2 id="dosisModalTitle">Medicamentos</h2>
                    <button class="dosis-modal-close"><i class="fas fa-times"></i></button>
                </div>
                <div class="dosis-modal-body" id="dosisModalBody"></div>
            </div>
        </div>

        <!-- Modal de Disclaimer Legal -->
        <div id="disclaimerModal" class="modal" style="display: none;">
            <div class="modal-content modal-disclaimer">
                <div class="modal-header">
                    <h2><i class="fas fa-exclamation-triangle"></i> Aviso Legal y Responsabilidad</h2>
                </div>
                <div class="modal-body">
                    <div class="disclaimer-content">
                        <p><strong>Esta aplicaci칩n nace con la idea de servir de ayuda en situaciones de estr칠s para el empleo de medicaci칩n y material en el ni침o cr칤tico.</strong></p>
                        
                        <p>Contiene solamente algunas de las drogas que potencialmente ser칤an necesarias para el manejo de un ni침o cr칤tico. La aplicaci칩n contiene informaci칩n de seguridad de algunas medicaciones, enfocada a ser de ayuda en situaciones de urgencia.</p>
                        
                        <p><strong>Sin embargo, el usuario debe conocer las medicaciones a emplear y consultar otras fuentes en caso de precisarlo. Debe ajustarse a la situaci칩n cl칤nica de cada paciente.</strong></p>
                        
                        <div class="disclaimer-warning">
                            <p><i class="fas fa-exclamation-circle"></i> <strong>Por favor, tenga en cuenta que los creadores de esta aplicaci칩n no tendr치n ninguna responsabilidad en relaci칩n al uso de la misma en la pr치ctica cl칤nica.</strong></p>
                            
                            <p>Aunque hemos extremado los controles y comprobaciones para minimizar la posibilidad de errores, el usuario debe conocer que es <strong>responsable de las medicaciones y del material que emplea</strong> en la estabilizaci칩n del paciente pedi치trico a su cargo.</p>
                        </div>
                    </div>
                    
                    <div class="disclaimer-actions">
                        <button id="acceptDisclaimerBtn" class="btn btn-primary btn-large">
                            <i class="fas fa-check"></i> Acepto y Entiendo
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pie de p치gina -->
        <footer class="footer">
            <p>&copy; 2025 UCI Pediatr칤a. Calculadora Cl칤nica v1.0.1</p>
            <p class="disclaimer">丘멆잺 Herramienta de referencia. Siempre consulte con profesionales m칠dicos.</p>
            <p class="footer-credits">
                <small>
                    <a href="#" id="showDisclaimerLink">Ver Aviso Legal</a>
                </small>
            </p>
        </footer>
    </div>

    <!-- Modal de detalle de medicamento desde b칰squeda -->
    <div id="medDetailModal" class="med-detail-modal">
        <div class="med-detail-content">
            <div class="med-detail-header">
                <h2 id="medDetailTitle">Medicamento</h2>
                <button class="med-detail-close" id="closeMedDetailBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="med-detail-body" id="medDetailBody">
                <!-- Se llena din치micamente -->
            </div>
        </div>
    </div>

    <script type="module">
        import { initTabs } from './js/tabs.js';
        import { initUI } from './js/ui.js';
        import { initSearch, searchMeds, getTabForType, showMedDetail } from './js/search.js';
        import { initTheme, toggleTheme, getThemeIcon, getThemeLabel } from './js/theme.js';
        import { announceSearchResults } from './js/announcer.js';
        
        // Inicializar componentes
        initTabs();
        await initUI();
        await initSearch();
        initTheme();
        
        // Configurar b칰squeda
        const searchInput = document.getElementById('searchInput');
        const searchResults = document.getElementById('searchResults');
        const medDetailModal = document.getElementById('medDetailModal');
        const closeMedDetailBtn = document.getElementById('closeMedDetailBtn');
        
        // Cerrar modal con bot칩n X
        if (closeMedDetailBtn) {
            closeMedDetailBtn.addEventListener('click', () => {
                medDetailModal.classList.remove('active');
            });
        }
        
        // Cerrar modal al clickear fuera
        if (medDetailModal) {
            medDetailModal.addEventListener('click', (e) => {
                if (e.target === medDetailModal) {
                    medDetailModal.classList.remove('active');
                }
            });
        }
        
        if (searchInput) {
            let selectedIndex = -1;
            let currentResults = [];
            let searchTimeout;

            searchInput.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                const query = e.target.value;
                selectedIndex = -1; // Reset selection
                
                if (query.length < 2) {
                    searchResults.classList.add('hidden');
                    searchInput.setAttribute('aria-expanded', 'false');
                    return;
                }
                
                // Debounce: espera 300ms antes de hacer la b칰squeda
                searchTimeout = setTimeout(() => {
                    const results = searchMeds(query);
                    currentResults = results;
                    
                    if (results.length === 0) {
                        searchResults.innerHTML = '<div class="search-no-results">No se encontraron medicamentos</div>';
                        searchResults.classList.remove('hidden');
                        searchInput.setAttribute('aria-expanded', 'true');
                        announceSearchResults(0);
                        return;
                    }
                    
                    // Agrupar resultados por tipo
                    const grouped = {};
                    results.forEach(result => {
                        if (!grouped[result.category]) {
                            grouped[result.category] = [];
                        }
                        grouped[result.category].push(result);
                    });
                    
                    let html = '';
                    let itemIndex = 0;
                    Object.entries(grouped).forEach(([category, items]) => {
                        html += `<div class="search-category">${category}</div>`;
                        items.forEach(item => {
                            html += `
                                <div class="search-item" data-type="${item.type}" data-key="${item.key}" data-nombre="${item.nombre}" data-index="${itemIndex}" role="option" tabindex="-1">
                                    <i class="fas fa-pills"></i>
                                    <span>${item.nombre}</span>
                                </div>
                            `;
                            itemIndex++;
                        });
                    });
                    
                    searchResults.innerHTML = html;
                    searchResults.classList.remove('hidden');
                    searchInput.setAttribute('aria-expanded', 'true');
                    announceSearchResults(results.length);
                    
                    // Agregar listeners a los items
                    document.querySelectorAll('.search-item').forEach(item => {
                        item.addEventListener('click', () => {
                            selectSearchItem(item);
                        });
                    });
                }, 300);
            });

            // Keyboard navigation
            searchInput.addEventListener('keydown', (e) => {
                const items = document.querySelectorAll('.search-item');
                if (items.length === 0) return;

                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    selectedIndex = Math.min(selectedIndex + 1, items.length - 1);
                    updateSelection(items);
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    selectedIndex = Math.max(selectedIndex - 1, -1);
                    updateSelection(items);
                } else if (e.key === 'Enter' && selectedIndex >= 0) {
                    e.preventDefault();
                    selectSearchItem(items[selectedIndex]);
                } else if (e.key === 'Escape') {
                    searchResults.classList.add('hidden');
                    searchInput.setAttribute('aria-expanded', 'false');
                }
            });

            function updateSelection(items) {
                items.forEach((item, idx) => {
                    if (idx === selectedIndex) {
                        item.classList.add('selected');
                        item.scrollIntoView({ block: 'nearest' });
                    } else {
                        item.classList.remove('selected');
                    }
                });
            }

            function selectSearchItem(item) {
                const type = item.dataset.type;
                const key = item.dataset.key;
                const nombre = item.dataset.nombre;
                
                // Mostrar modal con detalles del medicamento
                showMedDetail(type, key, nombre);
                
                // Limpiar b칰squeda
                searchInput.value = '';
                searchResults.classList.add('hidden');
                searchInput.setAttribute('aria-expanded', 'false');
                selectedIndex = -1;
            }
            
            // Cerrar resultados al hacer click fuera
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.search-wrapper')) {
                    searchResults.classList.add('hidden');
                    searchInput.setAttribute('aria-expanded', 'false');
                }
            });
        }
        
        // Configurar tema toggle
        const themeToggle = document.getElementById('themeToggle');
        if (themeToggle) {
            themeToggle.addEventListener('click', () => {
                toggleTheme();
                // Actualizar icono del bot칩n
                const icon = themeToggle.querySelector('i');
                const newIcon = getThemeIcon();
                icon.className = `fas ${newIcon}`;
                themeToggle.title = getThemeLabel();
            });
        }
    </script>
    
    <script>
        // Registrar Service Worker para PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('Service Worker registrado correctamente:', registration.scope);
                    })
                    .catch(error => {
                        console.log('Error al registrar Service Worker:', error);
                    });
            });
        }
    </script>
</body>
</html>

